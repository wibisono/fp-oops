<html><head><title>FP-oops: Expression Problem</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="wibisono" /><meta name="description" content="Learning FP with a hint of OOP in Scala" /><meta name="og:image" content="/fp-oops/img/poster.png" /><meta name="og:title" content="FP-oops: Expression Problem" /><meta name="og:site_name" content="FP-oops" /><meta name="og:url" content="https://wibisono.github.io/fp-oops/" /><meta name="og:type" content="website" /><meta name="og:description" content="Learning FP with a hint of OOP in Scala" /><link rel="icon" type="image/png" href="/fp-oops/img/favicon.png" /><meta name="twitter:title" content="FP-oops: Expression Problem" /><meta name="twitter:image" content="https://wibisono.github.io/fp-oops/img/poster.png" /><meta name="twitter:description" content="Learning FP with a hint of OOP in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@wongiseng" /><link rel="icon" type="image/png" sizes="16x16" href="/fp-oops/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/fp-oops/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/fp-oops/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/fp-oops/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/fp-oops/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/fp-oops/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/fp-oops/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/fp-oops/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/fp-oops/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/fp-oops/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/fp-oops/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/fp-oops/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/fp-oops/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/fp-oops/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/fp-oops/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/fp-oops/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/fp-oops/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/fp-oops/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/fp-oops/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/fp-oops/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/fp-oops/highlight/styles/default.css" /><link rel="stylesheet" href="/fp-oops/css/style.css" /><link rel="stylesheet" href="/fp-oops/css/palette.css" /><link rel="stylesheet" href="/fp-oops/css/codemirror.css" /><link rel="stylesheet" href="/fp-oops/css/fp-oops.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/fp-oops/" class="brand"><div class="brand-wrapper"><span>FP-oops</span></div></a></li> <li><a href="/fp-oops/docs/exercises.html" class="">Exercises</a> <ul class="sub_section"> <li><a href="/fp-oops/docs/kittens/uptime-client.html" class="">Uptime Client</a></li> <li><a href="/fp-oops/docs/kittens/map-reduce/map-reduce.html" class="">Map Reduce</a></li> <li><a href="/fp-oops/docs/kittens/validation/validation.html" class="">Data Validation</a></li> <li><a href="/fp-oops/docs/redbook/monoid.html" class="">Monoid</a></li> <li><a href="/fp-oops/docs/geekabyte/easingcats.html" class="">Geekabyte</a></li></ul></li> <li><a href="/fp-oops/docs/snippets.html" class="">Snippets</a> <ul class="sub_section"> <li><a href="/fp-oops/docs/snippets/fractal-plant.html" class="">Fractal-plant</a></li> <li><a href="/fp-oops/docs/snippets/sierpinski.html" class="">Sierpinski</a></li> <li><a href="/fp-oops/docs/snippets/speaking-creature.html" class="">Speaking Creature</a></li></ul></li> <li><a href="/fp-oops/docs/highlights.html" class="">Highlights</a> <ul class="sub_section"> <li><a href="/fp-oops/docs/highlights/config-kleisli.html" class="">Kleisli vs Plain FP</a></li> <li><a href="/fp-oops/docs/highlights/expression-atm.html" class="">Make OOP great again.</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/wibisono/fp-oops"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/wibisono/fp-oops"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('FP-oops Learning FP with a hint of OOP in Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('FP-oops Learning FP with a hint of OOP in Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="wibisono" data-github-repo="fp-oops"><div class="content-wrapper"><section><p>At the end of talks from Julien R Foy, about Existensial Types <a href="https://www.youtube.com/watch?v=6j5kZj17aUw">Make OOP Great Again</a> he discussed about how abstract type members can be used to represent object algebra that nicely solved expression problem.</p>

<p>In the first tab, the common approach is to encode expression using sealed trait and case classes. With this problem, you can not easily add multiplication operation for example, because then you have to rewrite all the interpreters, or even impossible if the sealed trait is not yours.</p>

<p>The second approach, using object algebras supposed to be more flexible, well watch the talk, I need to understand it better myself :)</p>

<ul id="problemTabs" class="nav nav-tabs">
    <li class="active"> <a class="nav-link" href="#reify-id" data-toggle="tab"><p>Sealed trait</p></a></li>
    <li> <a class="nav-link" href="#expression-atm-id" data-toggle="tab"><p>ATM Object algebra</p></a></li>
</ul>

<div class="tab-content"> 

<div role="tabpanel" id="reify-id" class="tab-pane active"><div data-scalafiddle="" data-dependency="org.typelevel %%% cats-mtl-core % 0.4.0,io.circe %%% circe-core % 0.8.0,io.circe %%% circe-generic % 0.8.0,io.circe %%% circe-parser % 0.8.0">
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Expr</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Lit</span><span class="o">(</span><span class="n">value</span> <span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Add</span><span class="o">(</span><span class="n">a</span> <span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span>

<span class="k">def</span> <span class="n">interpret</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">lit</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">add</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Expr</span> <span class="o">=&gt;</span> <span class="n">A</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Lit</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">lit</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
  <span class="k">case</span> <span class="nc">Add</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="n">add</span><span class="o">(</span><span class="n">interpret</span><span class="o">(</span><span class="n">lit</span><span class="o">,</span><span class="n">add</span><span class="o">)(</span><span class="n">a</span><span class="o">),</span><span class="n">interpret</span><span class="o">(</span><span class="n">lit</span><span class="o">,</span><span class="n">add</span><span class="o">)(</span><span class="n">b</span><span class="o">))</span>
<span class="o">}</span>
<span class="k">def</span> <span class="n">eval</span> <span class="k">=</span> <span class="n">interpret</span><span class="o">[</span><span class="kt">Int</span><span class="o">]((</span><span class="n">x</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">=&gt;</span><span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span><span class="n">b</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
<span class="k">def</span> <span class="n">show</span> <span class="k">=</span> <span class="n">interpret</span><span class="o">[</span><span class="kt">String</span><span class="o">]((</span><span class="n">x</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">=&gt;</span><span class="n">s</span><span class="s">"$x"</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span><span class="n">b</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"$a + $b"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">program</span> <span class="k">=</span> <span class="nc">Add</span><span class="o">(</span><span class="nc">Lit</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="nc">Add</span><span class="o">(</span><span class="nc">Lit</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="nc">Lit</span><span class="o">(</span><span class="mi">4</span><span class="o">)))</span>

<span class="n">println</span><span class="o">(</span><span class="n">show</span><span class="o">(</span><span class="n">program</span><span class="o">)</span> <span class="o">+</span> <span class="s">" = "</span> <span class="o">+</span> <span class="n">eval</span><span class="o">(</span><span class="n">program</span><span class="o">))</span>

</code></pre></div></div>
</div></div>

<div role="tabpanel" id="expression-atm-id" class="tab-pane"><div data-scalafiddle="" data-dependency="org.typelevel %%% cats-mtl-core % 0.4.0,io.circe %%% circe-core % 0.8.0,io.circe %%% circe-generic % 0.8.0,io.circe %%% circe-parser % 0.8.0">
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">ExprDsl</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Expr</span>
  <span class="k">def</span> <span class="nc">Lit</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Expr</span>
  <span class="k">def</span> <span class="nc">Add</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Expr</span>
<span class="o">}</span>
<span class="k">trait</span> <span class="nc">Eval</span> <span class="k">extends</span> <span class="nc">ExprDsl</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="nc">Int</span>
  <span class="k">def</span> <span class="nc">Lit</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">value</span>
  <span class="k">def</span> <span class="nc">Add</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">}</span>
<span class="k">trait</span> <span class="nc">Show</span> <span class="k">extends</span> <span class="nc">ExprDsl</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="nc">Lit</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">s</span><span class="s">"$value"</span>
  <span class="k">def</span> <span class="nc">Add</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">=</span> <span class="n">s</span><span class="s">"$a + $b"</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">Program</span> <span class="k">extends</span> <span class="nc">ExprDsl</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">expression</span> <span class="k">=</span> <span class="nc">Add</span><span class="o">(</span><span class="nc">Add</span><span class="o">(</span><span class="nc">Lit</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="nc">Lit</span><span class="o">(</span><span class="mi">4</span><span class="o">)),</span> <span class="nc">Lit</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">new</span> <span class="nc">Program</span> <span class="k">with</span> <span class="nc">Show</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"$expression"</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">new</span> <span class="nc">Program</span> <span class="k">with</span> <span class="nc">Eval</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"$expression"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
</div></div>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/fp-oops/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'wibisono/fp-oops'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/fp-oops/js/main.js"></script>
<script defer src='https://wibisono.github.io/fp-oops/integration.js'></script>
</body></html>