<html><head><title>FP-oops: Configuration using Kleisli</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="default" /><meta name="description" content="Learning FP with a hint of OOP in Scala" /><meta name="og:image" content="/fp-oops/img/poster.png" /><meta name="og:title" content="FP-oops: Configuration using Kleisli" /><meta name="og:site_name" content="FP-oops" /><meta name="og:url" content="https://wibisono.github.io/fp-oops/" /><meta name="og:type" content="website" /><meta name="og:description" content="Learning FP with a hint of OOP in Scala" /><link rel="icon" type="image/png" href="/fp-oops/img/favicon.png" /><meta name="twitter:title" content="FP-oops: Configuration using Kleisli" /><meta name="twitter:image" content="https://wibisono.github.io/fp-oops/img/poster.png" /><meta name="twitter:description" content="Learning FP with a hint of OOP in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@wongiseng" /><link rel="icon" type="image/png" sizes="16x16" href="/fp-oops/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/fp-oops/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/fp-oops/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/fp-oops/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/fp-oops/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/fp-oops/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/fp-oops/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/fp-oops/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/fp-oops/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/fp-oops/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/fp-oops/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/fp-oops/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/fp-oops/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/fp-oops/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/fp-oops/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/fp-oops/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/fp-oops/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/fp-oops/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/fp-oops/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/fp-oops/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/fp-oops/highlight/styles/default.css" /><link rel="stylesheet" href="/fp-oops/css/style.css" /><link rel="stylesheet" href="/fp-oops/css/palette.css" /><link rel="stylesheet" href="/fp-oops/css/codemirror.css" /><link rel="stylesheet" href="/fp-oops/css/fp-oops.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/fp-oops/" class="brand"><div class="brand-wrapper"><span>FP-oops</span></div></a></li> <li><a href="/fp-oops/docs/exercises.html" class="">Exercises</a> <ul class="sub_section"> <li><a href="/fp-oops/docs/exercises/cats/uptime-client.html" class="">Uptime Client</a></li> <li><a href="/fp-oops/docs/exercises/cats/map-reduce/map-reduce.html" class="">Map Reduce</a></li> <li><a href="/fp-oops/docs/exercises/cats/validation/validation.html" class="">Data Validation</a></li></ul></li> <li><a href="/fp-oops/docs/snippets.html" class="">Snippets</a></li> <li><a href="/fp-oops/docs/notes.html" class="">Notes</a></li> <li><a href="/fp-oops/docs/highlights.html" class="">Highlights</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/wibisono/fp-oops"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/wibisono/fp-oops"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('FP-oops Learning FP with a hint of OOP in Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('FP-oops Learning FP with a hint of OOP in Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="wibisono" data-github-repo="fp-oops"><div class="content-wrapper"><section><p>This is actually an example from <a href="https://www.youtube.com/watch?v=YXDm3WHZT5g">Oderskyâ€™s talk</a> not how to read config, before he explain the plain Functional programming approach using implicit functions.  The one discussed in the talk is the second tab, the kleisli version, while this first tab is what I might have done myself, using plain options and for comprehension.</p>

<p>Just by writing these snippets my fear of Kleisli and WTF feeling whenever I see it reduced a lot. It is just an arrow of transformation, and you are just using it to compose functions, converting input to output within a certain context. In this case, the context is Option, and you are composing <code class="highlighter-rouge">readName</code> with <code class="highlighter-rouge">readAge</code> to get <code class="highlighter-rouge">readPerson</code>.</p>

<p>Without Kleisli on the left tab, you can only do it by passing config around. Kleisli allow you to do it without actually passing value parameter, but by composing the arrows.</p>

<ul id="problemTabs" class="nav nav-tabs">
    <li class="active"> <a class="nav-link" href="#plain-id" data-toggle="tab"><p>Plain Config</p></a></li>
    <li> <a class="nav-link" href="#kleisli-id" data-toggle="tab"><p>Kleisli Config</p></a></li>
</ul>

<div class="tab-content"> 

<div role="tabpanel" id="plain-id" class="tab-pane active"><div data-scalafiddle="" data-dependency="org.typelevel %%% cats-core % 1.0.1,io.circe %%% circe-core % 0.8.0,io.circe %%% circe-generic % 0.8.0,io.circe %%% circe-parser % 0.8.0">
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">last</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Age</span><span class="o">(</span><span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span> <span class="k">:</span> <span class="kt">Name</span><span class="o">,</span> <span class="n">age</span> <span class="k">:</span> <span class="kt">Age</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>

<span class="k">def</span> <span class="n">readName</span><span class="o">(</span><span class="n">config</span><span class="k">:</span><span class="kt">Config</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Name</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">" "</span><span class="o">).</span><span class="n">toList</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">first</span> <span class="o">::</span> <span class="n">last</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">" "</span><span class="o">)))</span>
      <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">None</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">def</span> <span class="n">readAge</span><span class="o">(</span><span class="n">config</span><span class="k">:</span><span class="kt">Config</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Age</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">config</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">122</span><span class="o">)</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Age</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">age</span><span class="o">))</span>
    <span class="k">else</span> <span class="nc">None</span>
<span class="o">}</span>
<span class="c1">// I left this lines blank, just so that you can switch tabs  and compare at the same level
// the following plain readPerson function with the Kleisli version on the other tab
</span>
<span class="c1">// They look completely similar, just notice the difference
// Kleisli version is just composing arrows/functions, you are not passing any parameter
</span><span class="k">def</span> <span class="n">readPerson</span><span class="o">(</span><span class="n">config</span><span class="k">:</span><span class="kt">Config</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="n">name</span> <span class="k">&lt;-</span> <span class="n">readName</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
    <span class="n">age</span>  <span class="k">&lt;-</span> <span class="n">readAge</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
<span class="o">}</span> <span class="k">yield</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">age</span><span class="o">)</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="nc">Config</span><span class="o">(</span><span class="s">"Simon Peyton Jones"</span><span class="o">,</span> <span class="mi">60</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">readPerson</span><span class="o">(</span><span class="n">config</span><span class="o">))</span>
</code></pre></div></div>
</div></div>

<div role="tabpanel" id="kleisli-id" class="tab-pane"><div data-scalafiddle="" data-dependency="org.typelevel %%% cats-core % 1.0.1,io.circe %%% circe-core % 0.8.0,io.circe %%% circe-generic % 0.8.0,io.circe %%% circe-parser % 0.8.0">
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">last</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Age</span><span class="o">(</span><span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span> <span class="k">:</span> <span class="kt">Name</span><span class="o">,</span> <span class="n">age</span> <span class="k">:</span> <span class="kt">Age</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>

<span class="k">def</span> <span class="n">readName</span><span class="o">(</span><span class="n">config</span><span class="k">:</span><span class="kt">Config</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Name</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">" "</span><span class="o">).</span><span class="n">toList</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">first</span> <span class="o">::</span> <span class="n">last</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">" "</span><span class="o">)))</span>
      <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">None</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">def</span> <span class="n">readAge</span><span class="o">(</span><span class="n">config</span><span class="k">:</span><span class="kt">Config</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Age</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">config</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">122</span><span class="o">)</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Age</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">age</span><span class="o">))</span>
    <span class="k">else</span> <span class="nc">None</span>
<span class="o">}</span>
<span class="k">import</span> <span class="nn">cats.data.Kleisli</span>
<span class="k">val</span> <span class="n">readNameK</span> <span class="k">=</span> <span class="nc">Kleisli</span><span class="o">(</span><span class="n">readName</span><span class="o">)</span>
<span class="k">val</span> <span class="n">readAgeK</span> <span class="k">=</span> <span class="nc">Kleisli</span><span class="o">(</span><span class="n">readAge</span><span class="o">)</span>

<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">val</span> <span class="n">readPersonK</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="n">name</span> <span class="k">&lt;-</span> <span class="n">readNameK</span>  
    <span class="n">age</span>  <span class="k">&lt;-</span> <span class="n">readAgeK</span>
<span class="o">}</span> <span class="k">yield</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">age</span><span class="o">)</span>

<span class="k">val</span> <span class="n">configK</span> <span class="k">=</span> <span class="nc">Config</span><span class="o">(</span><span class="s">"Martin Odersky"</span><span class="o">,</span> <span class="mi">59</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">readPersonK</span><span class="o">(</span><span class="n">configK</span><span class="o">))</span>
</code></pre></div></div>
</div></div>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/fp-oops/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'wibisono/fp-oops'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/fp-oops/js/main.js"></script>
<script defer src='https://wibisono.github.io/fp-oops/integration.js'></script>
</body></html>